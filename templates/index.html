<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ›²å¥‡æ•™åŠ¡ - æˆç»©ç›‘æ§</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/vant@4/lib/index.css">
    <style>
        :root {
            --primary-color: #885021;
            --primary-color-light: #8B5A2B;
            --primary-color-dark: #5D3615;
            --text-primary: #1C1C1E;
            --text-secondary: #8E8E93;
            --bg-primary: #F2F2F7;
            --bg-secondary: #FFFFFF;
            --spacing-lg: 16px;
            --radius-lg: 16px;
            --radius-md: 12px;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "SF Pro Text", "Helvetica Neue", "PingFang SC", sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
        }

        .page-container {
            min-height: 100vh;
            padding: var(--spacing-lg);
            padding-top: 60px;
        }

        .logo-section {
            text-align: center;
            padding: 40px 0 30px;
        }

        .logo-title {
            font-size: 28px;
            font-weight: 600;
            color: var(--primary-color);
            margin-bottom: 8px;
        }

        .logo-subtitle {
            font-size: 15px;
            color: var(--text-secondary);
        }

        .card {
            background: var(--bg-secondary);
            border-radius: var(--radius-lg);
            padding: var(--spacing-lg);
            margin-bottom: 12px;
        }

        .agreement-card {
            background: rgba(136, 80, 33, 0.05);
            border-radius: var(--radius-md);
            padding: 12px;
            margin-bottom: 16px;
            max-height: 200px;
            overflow-y: auto;
        }

        .agreement-title {
            font-size: 15px;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 8px;
        }

        .agreement-text {
            font-size: 13px;
            line-height: 1.6;
            color: var(--text-secondary);
            margin-bottom: 6px;
        }

        .van-button--primary {
            background: var(--primary-color);
            border-color: var(--primary-color);
        }

        .van-button--primary:active {
            background: var(--primary-color-dark);
            border-color: var(--primary-color-dark);
        }

        .link-text {
            text-align: center;
            margin-top: 20px;
            font-size: 15px;
        }

        .link-text a {
            color: var(--primary-color);
            text-decoration: none;
        }
    </style>
</head>
<body>
    <div id="app">
        <div class="page-container">
            <div class="logo-section">
                <div class="logo-title">ğŸª æ›²å¥‡æ•™åŠ¡</div>
                <div class="logo-subtitle">æˆç»©ç›‘æ§ç³»ç»Ÿ</div>
            </div>

            <div class="card">
                <div class="agreement-card">
                    <div class="agreement-title">ç”¨æˆ·åè®®ä¸å®‰å…¨å£°æ˜</div>
                    <div class="agreement-text">1. æœ¬ç³»ç»Ÿä»…å­˜å‚¨æ‚¨çš„ç™»å½•Sessionç”¨äºè‡ªåŠ¨æŸ¥è¯¢æˆç»©ï¼Œä¸ä¿å­˜å­¦å·å’Œå¯†ç ã€‚</div>
                    <div class="agreement-text">2. ç³»ç»Ÿä½¿ç”¨å­¦å·å“ˆå¸Œå€¼ä½œä¸ºç”¨æˆ·æ ‡è¯†ï¼Œç”¨äºå­˜å‚¨åŠ å¯†Sessionå’Œå¯ç”¨çŠ¶æ€ã€‚</div>
                    <div class="agreement-text">3. Sessionæ•°æ®ä½¿ç”¨AES-256-GCMåŠ å¯†ç®—æ³•å­˜å‚¨ï¼Œæ¯ä¸ªç”¨æˆ·ä½¿ç”¨ç‹¬ç«‹çš„éšæœºå¯†é’¥ã€‚</div>
                    <div class="agreement-text">4. ç³»ç»Ÿä¼šå®šæ—¶æ£€æµ‹æˆç»©å˜åŒ–ï¼Œå‘ç°æ–°æˆç»©æ—¶é€šè¿‡é’‰é’‰æ¨é€é€šçŸ¥ã€‚</div>
                    <div class="agreement-text">5. å½“Sessionè¿‡æœŸæ—¶ï¼Œç³»ç»Ÿä¼šåœæ­¢ç›‘æ§å¹¶å‘é€æé†’ï¼Œéœ€è¦é‡æ–°ç™»å½•ã€‚</div>
                    <div class="agreement-text">6. è¯·å¦¥å–„ä¿ç®¡æ‚¨çš„é’‰é’‰Webhookåœ°å€å’Œç­¾åå¯†é’¥ï¼Œé¿å…æ³„éœ²ã€‚</div>
                </div>

                <van-form @submit="onSubmit">
                    <van-cell-group inset>
                        <van-field
                            v-model="form.user_account"
                            label="å­¦å·"
                            placeholder="è¯·è¾“å…¥å­¦å·"
                            :rules="[{ required: true, message: 'è¯·è¾“å…¥å­¦å·' }]"
                        />
                        <van-field
                            v-model="form.user_password"
                            type="password"
                            label="å¯†ç "
                            placeholder="è¯·è¾“å…¥å¯†ç "
                            :rules="[{ required: true, message: 'è¯·è¾“å…¥å¯†ç ' }]"
                        />
                        <van-field
                            v-model="form.dingtalk_webhook"
                            label="é’‰é’‰Webhook"
                            placeholder="https://oapi.dingtalk.com/robot/send?..."
                            :rules="[{ required: true, message: 'è¯·è¾“å…¥é’‰é’‰Webhook' }]"
                        />
                        <van-field
                            v-model="form.dingtalk_secret"
                            label="é’‰é’‰ç­¾å"
                            placeholder="SEC..."
                            :rules="[{ required: true, message: 'è¯·è¾“å…¥é’‰é’‰ç­¾åå¯†é’¥' }]"
                        />
                    </van-cell-group>

                    <div style="margin: 16px 0;">
                        <van-checkbox v-model="agreed">æˆ‘å·²é˜…è¯»å¹¶åŒæ„ç”¨æˆ·åè®®ä¸å®‰å…¨å£°æ˜</van-checkbox>
                    </div>

                    <van-button
                        round
                        block
                        type="primary"
                        native-type="submit"
                        :disabled="!agreed"
                        :loading="loading"
                    >
                        ç™»å½•å¹¶å¼€å§‹ç›‘æ§
                    </van-button>
                </van-form>
            </div>

            <div class="link-text">
                <a href="/admin">è¿›å…¥ç®¡ç†åå° â†’</a>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/vue@3/dist/vue.global.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/vant@4/lib/vant.min.js"></script>
    <script>
        const { createApp } = Vue;

        createApp({
            data() {
                return {
                    form: {
                        user_account: '',
                        user_password: '',
                        dingtalk_webhook: '',
                        dingtalk_secret: ''
                    },
                    agreed: false,
                    loading: false
                }
            },
            methods: {
                async onSubmit() {
                    if (!this.agreed) {
                        vant.showToast('è¯·å…ˆåŒæ„ç”¨æˆ·åè®®');
                        return;
                    }

                    this.loading = true;

                    try {
                        const response = await fetch('/api/login', {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify(this.form)
                        });

                        const data = await response.json();

                        if (data.success) {
                            vant.showSuccessToast(data.message);
                            this.form = {
                                user_account: '',
                                user_password: '',
                                dingtalk_webhook: '',
                                dingtalk_secret: ''
                            };
                        } else {
                            vant.showFailToast(data.message);
                        }
                    } catch (error) {
                        vant.showFailToast('è¯·æ±‚å¤±è´¥: ' + error.message);
                    } finally {
                        this.loading = false;
                    }
                }
            }
        }).use(vant).mount('#app');
    </script>
</body>
</html>
